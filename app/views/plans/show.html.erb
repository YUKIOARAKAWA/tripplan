

<div class="container-fluid">
	<div class="row">
		<div class="col-md-6">
      <div class="panel panel-warning">
      	<div class="panel-heading">
      		プラン
      	</div>
      	<div class="panel-body">
          <p>
            <strong>Area:</strong>
            <%= @plan.area.name %>
          </p>
          <p>
            <strong>Name:</strong>
            <%= @plan.name %>
          </p>

          <p>
            <strong>Start date:</strong>
            <%= @plan.start_date %>
          </p>

          <p>
            <strong>End date:</strong>
            <%= @plan.end_date %>
          </p>
      	</div>
      </div>
    </div>
		<div class="col-md-6">
      <div class="panel panel-info">
      	<div class="panel-heading">
      		メンバー
      	</div>
      	<div class="panel-body">
          <% @members.each do |member| %>
            ・<td><%= member.email %></td><br>
          <% end %>
          <td><%=link_to "メンバーを変更する", member_plan_path(@plan)%></td><br>
      	</div>
      </div>
    </div>
	</div>
</div>




<div class="container-fluid">
	<div class="row">
		<div class="col-md-6">
      <div style='width: 700px;'>
        <div id="map" style='width: 650px; height: 400px;'></div>
      </div>
    </div>
		<div class="col-md-6">
      <table class = "table">
      <thead>
        <tr>
        <th>順番</th>
        <th>登録者</th>
        <th>場所</th>
        <!-- 緯度・経度は表示しない<th>緯度</th>-->
        <!-- 緯度・経度は表示しない<th>経度</th>-->
        <tr>
      </thead>
      <tbody>
        <% @places.each do |place| %>
        <tr>
          <td><%= place.route %></td>
          <td><%= place.user.email %></td>
          <td><%= place.address %></td>
          <!-- 緯度・経度は表示しない<td><%= place.latitude %></td>-->
          <!--緯度・経度は表示しない<td><%= place.longitude %></td>-->
        </tr>
        <% end %>
      <tbody>
      </table>
    </div>
	</div>
</div>




<%= link_to 'Edit', edit_plan_path(@plan) %> |
<%= link_to 'Back', plans_path %>






<h3>新しく場所を追加する</h3>
<%= form_for @place, url: add_plans_path, method: "post" do |f| %>
  <% if @place.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@place.errors.count, "error") %> prohibited this place from being saved:</h2>

      <ul>
      <% @place.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.hidden_field :user_id, value: current_user.id  %>
  </div>
  <div class="field">
    <%= f.hidden_field :plan_id, value: @plan.id %>
  </div>
  <div class="field">
    <%= f.label :address %><br>
    <%= f.text_field :address %>
  </div>
  <div class="field">
    <%= f.hidden_field :latitude %>
  </div>
  <div class="field">
    <%= f.hidden_field :longitude %>
  </div>
  <div class="field">
    <%= f.hidden_field :route %>
  </div>

    <%= f.fields_for :pins do |c| %>
    <div class="field">
      <%= c.label :comment %><br>
      <%= c.text_field :comment %>
    </div>
    <div class="field">
      <%= c.label :want %><br>
      <%= c.radio_button :want, 0 %>低
      <%= c.radio_button :want, 1, :checked => "checked" %>中
      <%= c.radio_button :want, 2 %>高
    </div>
    <% end %>
  <div class="actions">
    <%= f.submit value: "追加"%>
  </div>
<% end %>
<button type="button" id = "create_routes">経路を作成！</button><br>




<script type="text/javascript">
  handler = Gmaps.build('Google');
  defo = new google.maps.LatLng( 39.0686606 , 141.3507552 );
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(5);
    handler.map.centerOn(defo);
  });


polylines = [];
 document.getElementById( 'create_routes' ).onclick = function( e )
 {
   /* 関係ない動作を無効化 */
   var e = e || window.event ;
   e.preventDefault() ;
   e.stopPropagation() ;

 poli = [];
 point = <%= @point %>;
 alert(point.length);
  for (var i = 0; i < point.length; i++) {
	//alert(point[i][1]);
	//alert(point[i][0]);
	//alert(i);
  poli.push(new google.maps.LatLng( point[i][0], point[i][1] ));
};

 // var flightPlanCoordinates = [
 // 	new google.maps.LatLng( 35.5, 134.25 ) ,
 //  new google.maps.LatLng( 35.4, 133.31 )
 // ];

// alert("固定");
// alert(flightPlanCoordinates);
alert("可変");
		alert(poli);
     //1つ目の線(Polyline)のインスタンスを作成する
     //new google.maps.Polyline() ]の引数にオプションオブジェクトを指定する
		 //固定で線を引くことはできる

   polylines[0] = new google.maps.Polyline( {
   	map: handler.getMap() ,
   	path:
			poli
   } ) ;
 };

</script>
